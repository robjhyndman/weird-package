<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="All functions and data sets required for the examples in the book
    Hyndman (2024) &quot;That's Weird: Anomaly Detection Using R&quot; &lt;https://OTexts.com/weird/&gt;.  
    All packages needed to run the examples are also loaded.">
<title>Functions and Data Sets for "That's Weird: Anomaly Detection Using R" by Rob J Hyndman • weird</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Fira_Sans-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Functions and Data Sets for " that weird: anomaly detection using r by rob j hyndman>
<meta property="og:description" content="All functions and data sets required for the examples in the book
    Hyndman (2024) &quot;That's Weird: Anomaly Detection Using R&quot; &lt;https://OTexts.com/weird/&gt;.  
    All packages needed to run the examples are also loaded.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">weird</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/robjhyndman/weird-package/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="weird-">weird <img src="reference/figures/weird-hex.png" align="right" width="150"><a class="anchor" aria-label="anchor" href="#weird-"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The weird package contains functions and data used in the book <a href="https://OTexts.com/weird/" class="external-link"><em>That’s Weird: Anomaly Detection Using R</em></a> by Rob J Hyndman. It also loads several packages needed to do the analysis described in the book.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of weird from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"robjhyndman/weird-package"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p><code><a href="https://pkg.robjhyndman.com/weird-package/">library(weird)</a></code> will load the following packages:</p>
<ul>
<li>
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>, for data manipulation.</li>
<li>
<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>, for data visualisation.</li>
<li>
<a href="https://cran.r-project.org/package=ks" class="external-link">ks</a>, for fitting models and producing forecasts.</li>
</ul>
<p>You also get a condensed summary of conflicts with other packages you have loaded:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/weird-package/">weird</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching packages ────────────────────────────────────── weird 0.0.0.9000 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr   1.1.4      ✔ ks      1.14.1</span></span>
<span><span class="co">#&gt; ✔ ggplot2 3.4.4</span></span>
<span><span class="co">#&gt; ── Conflicts ──────────────────────────────────────────────── weird_conflicts ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-old-faithful-geyser-data">Example: Old Faithful Geyser data<a class="anchor" aria-label="anchor" href="#example-old-faithful-geyser-data"></a>
</h2>
<p>The <code>oldfaithful</code> data set contains eruption data from the Old Faithful Geyser in Yellowstone National Park, Wyoming, USA, from 1 January 2015 to 1 October 2021. The data were obtained from the <a href="https://geysertimes.org" class="external-link">geysertimes.org</a> website. Recordings are incomplete, especially during the winter months when observers may not be present. There also appear to be some recording errors. The data set contains 2261 observations of 3 variables: <code>time</code> giving the time at which each eruption began, <code>duration</code> giving the length of the eruption in seconds, and <code>waiting</code> giving the time to the next eruption in seconds. In the analysis below, we omit the eruption with <code>duration</code> greater than 1 hour as this is likely to be a recording error. Some of the long <code>waiting</code> values are probably due to omitted eruptions, and so we also omit eruptions with <code>waiting</code> greater than 2 hours.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldfaithful</span></span>
<span><span class="co">#&gt; # A tibble: 2,261 × 3</span></span>
<span><span class="co">#&gt;    time                duration waiting</span></span>
<span><span class="co">#&gt;    &lt;dttm&gt;                 &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 2015-01-02 14:53:00      271    5040</span></span>
<span><span class="co">#&gt;  2 2015-01-09 23:55:00      247    6060</span></span>
<span><span class="co">#&gt;  3 2015-02-07 00:49:00      203    5460</span></span>
<span><span class="co">#&gt;  4 2015-02-14 01:09:00      195    5221</span></span>
<span><span class="co">#&gt;  5 2015-02-21 01:12:00      210    5401</span></span>
<span><span class="co">#&gt;  6 2015-02-28 01:11:00      185    5520</span></span>
<span><span class="co">#&gt;  7 2015-03-07 00:50:00      160    5281</span></span>
<span><span class="co">#&gt;  8 2015-03-13 21:57:00      226    6000</span></span>
<span><span class="co">#&gt;  9 2015-03-13 23:37:00      190    5341</span></span>
<span><span class="co">#&gt; 10 2015-03-20 22:26:00      102    3961</span></span>
<span><span class="co">#&gt; # ℹ 2,251 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="kernel-density-estimates">Kernel density estimates<a class="anchor" aria-label="anchor" href="#kernel-density-estimates"></a>
</h2>
<p>The package provides the <code><a href="reference/kde_bandwidth.html">kde_bandwidth()</a></code> function for estimating the bandwidth of a kernel density estimate, and an <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> method for plotting the resulting density. The figure below shows the kernel density estimate of the <code>duration</code> variable obtained using these functions. The rug plot shows the actual data values.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">&lt;-</span> <span class="va">oldfaithful</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">duration</span> <span class="op">&lt;</span> <span class="fl">3600</span>, <span class="va">waiting</span> <span class="op">&lt;</span> <span class="fl">7200</span><span class="op">)</span></span>
<span><span class="va">of_density</span> <span class="op">&lt;-</span> <span class="fu">kde</span><span class="op">(</span><span class="va">of</span><span class="op">$</span><span class="va">duration</span>, h<span class="op">=</span><span class="fu"><a href="reference/kde_bandwidth.html">kde_bandwidth</a></span><span class="op">(</span><span class="va">of</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">of_density</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_rug</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">duration</span><span class="op">)</span>, <span class="va">of</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Duration (seconds)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-of-density-1.png" style="width:100.0%"></p>
<p>The <code><a href="reference/kde_bandwidth.html">kde_bandwidth()</a></code> function can also be used to estimate the bandwidth for a bivariate kernel density estimate. The figure below shows the kernel density estimate of the <code>duration</code> and <code>waiting</code> variables using the bandwidth selected by the <code><a href="reference/kde_bandwidth.html">kde_bandwidth()</a></code> function. The rug plot shows the actual data values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of_density</span> <span class="op">&lt;-</span> <span class="va">of</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">kde</span><span class="op">(</span>H <span class="op">=</span> <span class="fu"><a href="reference/kde_bandwidth.html">kde_bandwidth</a></span><span class="op">(</span><span class="va">of</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"duration"</span>,<span class="st">"waiting"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">of_density</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">of</span>, alpha<span class="op">=</span><span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Duration (seconds)"</span>, y <span class="op">=</span> <span class="st">"Waiting time (seconds)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-of-density2-1.png" style="width:100.0%"></p>
</div>
<div class="section level2">
<h2 id="statistical-tests">Statistical tests<a class="anchor" aria-label="anchor" href="#statistical-tests"></a>
</h2>
<p>Some old methods of anomaly detection used statistical tests. While these are not recommended, they are still widely used, and are provided in the package for comparison purposes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="reference/peirce_anomalies.html">peirce_anomalies</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   time                duration waiting</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;                 &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2018-04-25 19:08:00        1    5700</span></span>
<span><span class="va">of</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="reference/peirce_anomalies.html">chauvenet_anomalies</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   time                duration waiting</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;                 &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2018-04-25 19:08:00        1    5700</span></span>
<span><span class="va">of</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="reference/grubbs_anomalies.html">grubbs_anomalies</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   time                duration waiting</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;                 &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2018-04-25 19:08:00        1    5700</span></span>
<span><span class="va">of</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="reference/grubbs_anomalies.html">dixon_anomalies</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   time                duration waiting</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;                 &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 2018-04-25 19:08:00        1    5700</span></span></code></pre></div>
<p>In this example, they only detect the tiny 1-second duration, which is almost certainly a recording error. An explanation of these tests is provided in <a href="https://otexts.com/weird/04-tests.html" class="external-link">Chapter 4 of the book</a></p>
</div>
<div class="section level2">
<h2 id="boxplots">Boxplots<a class="anchor" aria-label="anchor" href="#boxplots"></a>
</h2>
<p>Boxplots are widely used for anomaly detection. Here are three variations of boxplots applied to the <code>duration</code> variable.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"Duration (seconds)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-of-boxplot-1.png" style="width:100.0%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/hdrplot.html">gg_hdrboxplot</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Duration (seconds)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-of-boxplot-2.png" style="width:100.0%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/hdrplot.html">gg_hdrboxplot</a></span><span class="op">(</span><span class="va">duration</span>, scatterplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Duration (seconds)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-of-boxplot-3.png" style="width:100.0%"></p>
<p>The latter two plots are HDR boxplots, which allow the bimodality of the data to be seen. The dark shaded region contains 50% of the observations, while the lighter shaded region contains 99% of the observations. The plots use vertical jittering to reduce overplotting, and highlight potential outliers in red using the lookout algorithm (described in <a href="https://otexts.com/weird/06-density.html" class="external-link">Chapter 6 of the book</a>). An explanation of these plots is provided in <a href="https://otexts.com/weird/05-boxplots.html" class="external-link">Chapter 5 of the book</a>.</p>
<p>It is also possible to produce bivariate boxplots. Several variations are provided in the package. Here are two types of bagplot.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/bagplot.html">gg_bagplot</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Duration (seconds)"</span>, y <span class="op">=</span> <span class="st">"Waiting time (seconds)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-of-boxplot2-1.png" style="width:100.0%"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/bagplot.html">gg_bagplot</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span>, scatterplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Duration (seconds)"</span>, y <span class="op">=</span> <span class="st">"Waiting time (seconds)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-of-boxplot2-2.png" style="width:100.0%"></p>
<p>And here are two types of HDR boxplot</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/hdrplot.html">gg_hdrboxplot</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Duration (seconds)"</span>, y <span class="op">=</span> <span class="st">"Waiting time (seconds)"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="reference/figures/README-of-boxplot3-1.png" style="width:100.0%"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="reference/hdrplot.html">gg_hdrboxplot</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span>, scatterplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Duration (seconds)"</span>, y <span class="op">=</span> <span class="st">"Waiting time (seconds)"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="reference/figures/README-of-boxplot3-2.png" style="width:100.0%"></p>
<p>The latter two plots show likely outliers in red, using the lookout algorithm.</p>
</div>
<div class="section level2">
<h2 id="scoring-functions">Scoring functions<a class="anchor" aria-label="anchor" href="#scoring-functions"></a>
</h2>
<p>Several functions are provided for providing anomaly scores for all observations.</p>
<ul>
<li>The <code><a href="reference/density_scores.html">density_scores()</a></code> function uses either a fitted statistical model, or a kernel density estimate, to compute density scores.</li>
<li>The <code><a href="reference/stray_scores.html">stray_scores()</a></code> function uses the stray algorithm to compute anomaly scores.</li>
<li>The <code><a href="reference/lof_scores.html">lof_scores()</a></code> function uses local outlier factors to compute anomaly scores.</li>
<li>The <code><a href="reference/glosh_scores.html">glosh_scores()</a></code> function uses the Global-Local Outlier Score from Hierarchies algorithm to compute anomaly scores.</li>
<li>The <code><a href="reference/lookout.html">lookout()</a></code> function uses the lookout algorithm to compute anomaly probabilities</li>
</ul>
<p>Here are the top 0.02% most anomalous observations identified by each of the first four methods, along with the observations having lookout probability less than 0.05.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">of</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    denscore <span class="op">=</span> <span class="fu"><a href="reference/density_scores.html">density_scores</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    strayscore <span class="op">=</span> <span class="fu"><a href="reference/stray_scores.html">stray_scores</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    lofscore <span class="op">=</span> <span class="fu"><a href="reference/lof_scores.html">lof_scores</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>,</span>
<span>    gloshscore <span class="op">=</span> <span class="fu"><a href="reference/glosh_scores.html">glosh_scores</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    lookout <span class="op">=</span> <span class="fu"><a href="reference/lookout.html">lookout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">denscore</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">denscore</span>, prob<span class="op">=</span><span class="fl">0.998</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="va">strayscore</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">strayscore</span>, prob<span class="op">=</span><span class="fl">0.998</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="va">lofscore</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">lofscore</span>, prob<span class="op">=</span><span class="fl">0.998</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="va">gloshscore</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gloshscore</span>, prob<span class="op">=</span><span class="fl">0.998</span><span class="op">)</span> <span class="op">|</span></span>
<span>    <span class="va">lookout</span> <span class="op">&lt;</span> <span class="fl">0.05</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">lookout</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 11 × 8</span></span>
<span><span class="co">#&gt;    time                duration waiting denscore strayscore lofscore gloshscore</span></span>
<span><span class="co">#&gt;    &lt;dttm&gt;                 &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 2018-04-25 19:08:00        1    5700     17.5     0.380      3.78      1    </span></span>
<span><span class="co">#&gt;  2 2020-06-01 21:04:00      120    6060     17.5     0.132      1.88      1    </span></span>
<span><span class="co">#&gt;  3 2021-01-22 18:35:00      170    3600     16.8     0.0606     1.09      0.860</span></span>
<span><span class="co">#&gt;  4 2020-08-31 09:56:00      170    3840     16.7     0.0606     1.01      0.816</span></span>
<span><span class="co">#&gt;  5 2015-11-21 20:27:00      150    3420     16.7     0.0772     1.27      1    </span></span>
<span><span class="co">#&gt;  6 2017-05-03 06:19:00       90    4740     16.4     0.0495     1.68      1    </span></span>
<span><span class="co">#&gt;  7 2020-10-15 17:11:00      220    7080     15.7     0.0429     2.42      1    </span></span>
<span><span class="co">#&gt;  8 2017-09-22 18:51:00      281    7140     15.5     0.0333     2.64      1    </span></span>
<span><span class="co">#&gt;  9 2017-08-12 13:14:00      120    4920     15.2     0.0690     1.53      1    </span></span>
<span><span class="co">#&gt; 10 2020-05-18 21:21:00      272    7080     14.9     0.0333     2.42      1    </span></span>
<span><span class="co">#&gt; 11 2018-09-22 16:37:00      253    7140     14.7     0.0200     2.63      1    </span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: lookout &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="robust-multivariate-scaling">Robust multivariate scaling<a class="anchor" aria-label="anchor" href="#robust-multivariate-scaling"></a>
</h2>
<p>Some anomaly detection methods require the data to be scaled first, so all observations are on the same scale. However, many scaling methods are not robust to anomalies. The <code><a href="reference/mvscale.html">mvscale()</a></code> function provides a multivariate robust scaling method, that optionally takes account of the relationships betwen variables, and uses robust estimates of center, scale and covariance by default. The centers are removed using medians, the scale function is the IQR, and the covariance matrix is estimated using a robust OGK estimate. The data are scaled using the Cholesky decomposition of the inverse covariance. Then the scaled data are returned. The scaled variables are rotated to be orthogonal, so are renamed as <code>z1</code>, <code>z2</code>, etc. Non-rotated scaling is possible by setting <code>cov = NULL</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/mvscale.html">mvscale</a></span><span class="op">(</span><span class="va">of</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in mvscale(of): Ignoring non-numeric columns: time</span></span>
<span><span class="co">#&gt; # A tibble: 2,197 × 3</span></span>
<span><span class="co">#&gt;    time                    z1     z2</span></span>
<span><span class="co">#&gt;    &lt;dttm&gt;               &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 2015-01-02 14:53:00  2.06  -1.47 </span></span>
<span><span class="co">#&gt;  2 2015-01-09 23:55:00  0.130  0.801</span></span>
<span><span class="co">#&gt;  3 2015-02-07 00:49:00 -1.78  -0.534</span></span>
<span><span class="co">#&gt;  4 2015-02-14 01:09:00 -2.04  -1.07 </span></span>
<span><span class="co">#&gt;  5 2015-02-21 01:12:00 -1.38  -0.665</span></span>
<span><span class="co">#&gt;  6 2015-02-28 01:11:00 -2.76  -0.401</span></span>
<span><span class="co">#&gt;  7 2015-03-07 00:50:00 -3.92  -0.932</span></span>
<span><span class="co">#&gt;  8 2015-03-13 21:57:00 -0.932  0.668</span></span>
<span><span class="co">#&gt;  9 2015-03-13 23:37:00 -2.38  -0.799</span></span>
<span><span class="co">#&gt; 10 2015-03-20 22:26:00 -6.09  -3.87 </span></span>
<span><span class="co">#&gt; # ℹ 2,187 more rows</span></span>
<span><span class="fu"><a href="reference/mvscale.html">mvscale</a></span><span class="op">(</span><span class="va">of</span>, cov <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in mvscale(of, cov = NULL): Ignoring non-numeric columns: time</span></span>
<span><span class="co">#&gt; # A tibble: 2,197 × 3</span></span>
<span><span class="co">#&gt;    time                duration waiting</span></span>
<span><span class="co">#&gt;    &lt;dttm&gt;                 &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 2015-01-02 14:53:00    1.61   -1.48 </span></span>
<span><span class="co">#&gt;  2 2015-01-09 23:55:00    0.363   0.809</span></span>
<span><span class="co">#&gt;  3 2015-02-07 00:49:00   -1.92   -0.540</span></span>
<span><span class="co">#&gt;  4 2015-02-14 01:09:00   -2.33   -1.08 </span></span>
<span><span class="co">#&gt;  5 2015-02-21 01:12:00   -1.56   -0.672</span></span>
<span><span class="co">#&gt;  6 2015-02-28 01:11:00   -2.85   -0.405</span></span>
<span><span class="co">#&gt;  7 2015-03-07 00:50:00   -4.15   -0.942</span></span>
<span><span class="co">#&gt;  8 2015-03-13 21:57:00   -0.726   0.674</span></span>
<span><span class="co">#&gt;  9 2015-03-13 23:37:00   -2.59   -0.807</span></span>
<span><span class="co">#&gt; 10 2015-03-20 22:26:00   -7.16   -3.91 </span></span>
<span><span class="co">#&gt; # ℹ 2,187 more rows</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/robjhyndman/weird-package/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/robjhyndman/weird-package/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing weird</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Rob Hyndman <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-2140-5352" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/robjhyndman/weird-package/actions" class="external-link"><img src="https://github.com/robjhyndman/weird-package/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rob Hyndman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
