<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Density scores — density_scores • weird</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Density scores — density_scores"><meta property="og:description" content="Compute density scores or leave-one-out density scores from a
model or a kernel density estimate of a data set.
The density scores are defined as minus the log of the conditional density,
or kernel density estimate, at each observation.
The leave-one-out density scores (or LOO density scores) are obtained by
estimating the conditional density or kernel density estimate using all
other observations."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">weird</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/robjhyndman/weird-package/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Density scores</h1>
    <small class="dont-index">Source: <a href="https://github.com/robjhyndman/weird-package/blob/HEAD/R/log_scores.R" class="external-link"><code>R/log_scores.R</code></a></small>
    <div class="hidden name"><code>density_scores.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute density scores or leave-one-out density scores from a
model or a kernel density estimate of a data set.
The density scores are defined as minus the log of the conditional density,
or kernel density estimate, at each observation.
The leave-one-out density scores (or LOO density scores) are obtained by
estimating the conditional density or kernel density estimate using all
other observations.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">density_scores</span><span class="op">(</span><span class="va">object</span>, loo <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for default</span></span>
<span><span class="fu">density_scores</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  loo <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  h <span class="op">=</span> <span class="fu"><a href="kde_bandwidth.html">kde_bandwidth</a></span><span class="op">(</span><span class="va">object</span>, method <span class="op">=</span> <span class="st">"double"</span><span class="op">)</span>,</span>
<span>  H <span class="op">=</span> <span class="fu"><a href="kde_bandwidth.html">kde_bandwidth</a></span><span class="op">(</span><span class="va">object</span>, method <span class="op">=</span> <span class="st">"double"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for kde</span></span>
<span><span class="fu">density_scores</span><span class="op">(</span><span class="va">object</span>, loo <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for lm</span></span>
<span><span class="fu">density_scores</span><span class="op">(</span><span class="va">object</span>, loo <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for gam</span></span>
<span><span class="fu">density_scores</span><span class="op">(</span><span class="va">object</span>, loo <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>A model object or a numerical data set.</p></dd>


<dt>loo</dt>
<dd><p>Should leave-one-out density scores be computed?</p></dd>


<dt>...</dt>
<dd><p>Other arguments are ignored.</p></dd>


<dt>h</dt>
<dd><p>Bandwidth for univariate kernel density estimate. Default is <code><a href="kde_bandwidth.html">kde_bandwidth</a></code>.</p></dd>


<dt>H</dt>
<dd><p>Bandwidth for multivariate kernel density estimate. Default is <code><a href="kde_bandwidth.html">kde_bandwidth</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A numerical vector containing either the density scores, or the LOO
density scores.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>If the first argument is a numerical vector or matrix, then
a kernel density estimate is computed, using a Gaussian kernel,
with default bandwidth given by a robust normal reference rule.
Otherwise the model is used to compute the conditional
density function at each observation, from which the density scores (or
possibly the LOO density scores) are obtained.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="kde_bandwidth.html">kde_bandwidth</a></code>
<code><a href="https://rdrr.io/pkg/ks/man/kde.html" class="external-link">kde</a></code></p>
<p><code><a href="kde_bandwidth.html">kde_bandwidth</a></code>
<code><a href="https://rdrr.io/pkg/ks/man/kde.html" class="external-link">kde</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Rob J Hyndman</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">of</span> <span class="op">&lt;-</span> <span class="va">oldfaithful</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">duration</span> <span class="op">&lt;</span> <span class="fl">7000</span>, <span class="va">waiting</span> <span class="op">&lt;</span> <span class="fl">7000</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">mutate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fscores <span class="op">=</span> <span class="fu">density_scores</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    loo_fscores <span class="op">=</span> <span class="fu">density_scores</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">duration</span>, <span class="va">waiting</span><span class="op">)</span>, loo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    lookout_prob <span class="op">=</span> <span class="fu"><a href="lookout.html">lookout</a></span><span class="op">(</span>density_scores <span class="op">=</span> <span class="va">fscores</span>, loo_scores <span class="op">=</span> <span class="va">loo_fscores</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">of</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">duration</span>, y <span class="op">=</span> <span class="va">waiting</span>, color <span class="op">=</span> <span class="va">lookout_prob</span> <span class="op">&lt;</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="density_scores-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">of</span> <span class="op">&lt;-</span> <span class="va">oldfaithful</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">duration</span> <span class="op">&lt;</span> <span class="fl">7000</span>, <span class="va">waiting</span> <span class="op">&lt;</span> <span class="fl">7000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">f_kde</span> <span class="op">&lt;-</span> <span class="fu">kde</span><span class="op">(</span><span class="va">of</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, H <span class="op">=</span> <span class="fu"><a href="kde_bandwidth.html">kde_bandwidth</a></span><span class="op">(</span><span class="va">of</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">of</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">mutate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fscores <span class="op">=</span> <span class="fu">density_scores</span><span class="op">(</span><span class="va">f_kde</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    loo_fscores <span class="op">=</span> <span class="fu">density_scores</span><span class="op">(</span><span class="va">f_kde</span>, loo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2,189 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    time                duration waiting fscores loo_fscores</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2015-01-02 <span style="color: #949494;">14:53:00</span>      271    <span style="text-decoration: underline;">5</span>040    14.6        14.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2015-01-09 <span style="color: #949494;">23:55:00</span>      247    <span style="text-decoration: underline;">6</span>060    11.1        11.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2015-02-07 <span style="color: #949494;">00:49:00</span>      203    <span style="text-decoration: underline;">5</span>460    13.0        13.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2015-02-14 <span style="color: #949494;">01:09:00</span>      195    <span style="text-decoration: underline;">5</span>221    13.7        13.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2015-02-21 <span style="color: #949494;">01:12:00</span>      210    <span style="text-decoration: underline;">5</span>401    12.5        12.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2015-02-28 <span style="color: #949494;">01:11:00</span>      185    <span style="text-decoration: underline;">5</span>520    13.5        13.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2015-03-07 <span style="color: #949494;">00:50:00</span>      160    <span style="text-decoration: underline;">5</span>281    15.7        17.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2015-03-13 <span style="color: #949494;">21:57:00</span>      226    <span style="text-decoration: underline;">6</span>000    11.9        11.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2015-03-13 <span style="color: #949494;">23:37:00</span>      190    <span style="text-decoration: underline;">5</span>341    13.6        13.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2015-03-20 <span style="color: #949494;">22:26:00</span>      102    <span style="text-decoration: underline;">3</span>961    13.4        13.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2,179 more rows</span></span>
<span class="r-in"><span><span class="va">shiraz</span> <span class="op">&lt;-</span> <span class="va">wine_reviews</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variety</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Shiraz"</span>, <span class="st">"Syrah"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_wine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> <span class="op">~</span> <span class="va">points</span>, data <span class="op">=</span> <span class="va">shiraz</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shiraz</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">mutate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fscore <span class="op">=</span> <span class="fu">density_scores</span><span class="op">(</span><span class="va">fit_wine</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    loo_fscore <span class="op">=</span> <span class="fu">density_scores</span><span class="op">(</span><span class="va">fit_wine</span>, loo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    lookout_prob <span class="op">=</span> <span class="fu"><a href="lookout.html">lookout</a></span><span class="op">(</span>density_scores <span class="op">=</span> <span class="va">fscore</span>, loo_scores <span class="op">=</span> <span class="va">loo_fscore</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">points</span>, y <span class="op">=</span> <span class="va">price</span>, color <span class="op">=</span> <span class="va">lookout_prob</span> <span class="op">&lt;</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">geom_jitter</span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="density_scores-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">shiraz</span> <span class="op">&lt;-</span> <span class="va">wine_reviews</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variety</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Shiraz"</span>, <span class="st">"Syrah"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_wine</span> <span class="op">&lt;-</span> <span class="fu">mgcv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">points</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">shiraz</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shiraz</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">mutate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fscore <span class="op">=</span> <span class="fu">density_scores</span><span class="op">(</span><span class="va">fit_wine</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    lookout_prob <span class="op">=</span> <span class="fu"><a href="lookout.html">lookout</a></span><span class="op">(</span>density_scores <span class="op">=</span> <span class="va">fscore</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">points</span>, y <span class="op">=</span> <span class="va">price</span>, color <span class="op">=</span> <span class="va">lookout_prob</span> <span class="op">&lt;</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">geom_jitter</span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="density_scores-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rob Hyndman.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

